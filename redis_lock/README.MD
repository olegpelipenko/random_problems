Задача написать приложение, работающее с redis, умеющее как генерировать сообщения, так и
обрабатывать. Параллельно может быть запущено сколько угодно приложений.
 
Обмен любой информацией между приложениями осуществлять только через redis.
 
Все запущенные копии приложения кроме генератора, являются обработчиками сообщений и в любой
момент готовы получить сообщение из redis.
 
Все сообщения должны быть обработаны, причём только один раз, только одним из обработчиков.
 
Генератором должно быть только одно из запущенных приложений. Т.е. каждое приложение может
стать генератором. Но в любой момент времени может работать только один генератор.
 
Если текущий генератор завершить принудительно (обработчик завершения запрещен, например,
выключили из розетки), то одно из приложений должно заменить завершённое (упавшее) и стать
генератором. Для определения кто генератор нельзя использовать средства ОС, считается что все
приложения запущенны на разных серверах и общаются только через redis.
Сообщения генерируются раз в 500 мс.
 
Для генерации сообщения использовать любую функцию с рандомным текстовым ответом.
 
Приложение, получая сообщение, с вероятностью 5% определяет, что сообщение содержит ошибку.
 
Если сообщение содержит ошибку, то сообщение следует поместить в redis для дальнейшего изучения.
 
Если приложение запустить с параметром 'getErrors' то оно заберет из redis все сообщения с ошибкой,
выведет их на экран и завершится, при этом из базы сообщения удаляются.

____


1) Инстансов нет, база пустая

2) Создаётся новый инстанс ->
    в бесконечном цикле:
        проверяем наличие штампа publish процесса ->
            его нет или штамп просрочен ->
                создаём подписку, делаем штамп АТОМАРНО С ПРЕДЫДУЩИМ ДЕЙСТВИЕМ
                начинаем публиковать данные <- если тут повисли, то что нужно сделать??? может быть генерить сообщение сразу и пушить его или выбрасывать если мы в итоге оказались читателем
                при каждой публикации (?) обновляем штамп
            он есть ->
                пытаемся достать сообщение из очереди (виснем при неудаче?)
                    сообщение подходит нам если:
                        у него стоит InProgress и штамп > 1 секунды
                        у него не стоит InProgress
                сообщение достали, выславляем стейт сообщения InProgress АТОМАРНО
                проверяем на ошибку, если есть пишем, что это ошибка (в отдельную коллекцию) и удаляем сообщение АТОМАРНО

3) Убиваем инстанс ->
    publisher
        завершаем процесс

    subscriber
        в момент убийства имелось сообщение ->
            не удаляем сообщение
            завершаем процесс
        в момент убийства сообщение ещё не получено из очереди ->
            завершаем процесс

4) Создаётся новый инстанс getError
    читаем сообщения из базы и удаляем их АТОМАРНО
    выводим на экран


Если сообщение содержит ошибку, то нужно как то его пометить или куда то положить, чтобы не останавливать всю работу
остальных процессов?

Общее логирование?

Что делать если лаги сети и мы не успели обновить штамп?



Тесты:

Большое количество сообщений с уменьшенным таймаутом
Снимать снапшоты и писать их в логи
Можно сделать метод get_role, который будет говорить какая роль у инстанса и контроллировать что есть только один паблишер